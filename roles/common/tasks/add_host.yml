---
- name: ADD HOST | Add container '{{ container_name }}' to the hosts inventory
  add_host:
    hostname: "{{ container_name }}"
    groups: docker
    ansible_ssh_host: "{{ item.value.docker_networksettings.IPAddress }}"
    ansible_ssh_port: 22
  with_dict: docker_containers
  when: item.value.docker_state.Running|bool and item.key == container_name

- debug: msg="[Debug] ADD HOST | {{ hostvars[container_name] }}"
  with_dict: docker_containers
  when: do_debug|bool and item.value.docker_state.Running|bool and item.key == container_name

- name: ADD HOST | Extract IP for '{{ container_ip }}'
  set_fact: container_ip="{{ item.value.docker_networksettings.IPAddress }}"
  with_dict: docker_containers
- debug: msg="[Debug] ADD HOST | {{ container_ip }}"
  when: do_debug|bool and container_ip is defined

- name: ADD HOST | ping '{{ container_name }}'
  shell: echo ping -c 1 "{{ container_ip }}"
  with_dict: docker_containers
  when: item.value.docker_state.Running|bool and item.key == container_name and container_ip is defined

# - name: ADD HOST | ping '{{ container_name }}'
#   shell: echo ping -c 1 "{{ item.value.docker_networksettings.IPAddress }}"
#   with_dict: docker_containers
#   when: item.value.docker_state.Running|bool and item.key == container_name
